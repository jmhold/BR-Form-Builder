jQuery(document).ready(function(e){if(pagenow=="toplevel_page_visual-form-builder-pro"){e(".if-js-closed").removeClass("if-js-closed").addClass("closed");postboxes.add_postbox_toggles("toplevel_page_visual-form-builder-pro");columns.useCheckboxesForHidden();columns.checked=function(k){e(".vfb-item-"+k).removeClass("hidden-field")};columns.unchecked=function(k){e(".vfb-item-"+k).addClass("hidden-field")};e(".hide-column-tog").not(":checked").each(function(){e("#menu-to-edit").find(".vfb-item-"+e(this).val()).addClass("hidden-field")})}e(document).on("change",'.toplevel_page_visual-form-builder-pro .columns-prefs [type="radio"]',function(){if(3==e(this).val()){var k=e("#vfb-form-meta-preview iframe").contents().height();e("#vfb-form-meta-preview iframe").css({height:k})}});e(function(){var p=e("#vfb-form-meta-preview iframe"),l=20;function k(){for(var r=0,q=p.length;r<q;r++){p[r].style.height=l+p[r].contentWindow.document.body.offsetHeight+"px"}}if(e.browser.safari||e.browser.opera){p.load(function(){setTimeout(k,0)});for(var n=0,m=p.length;n<m;n++){var o=p[n].src;p[n].src="";p[n].src=o}}else{p.load(function(){this.style.height=l+this.contentWindow.document.body.offsetHeight+"px"})}});e("select#switcher_form").change(function(){var k=window.location.href,l=e("option:selected",this).val(),m=k.replace(new RegExp(/(\d+)$/g),"")+l;window.location=m});var c=null;e(document).on("mouseenter mouseleave",".vfb-tooltip",function(n){if(n.type=="mouseenter"){if(c){clearTimeout(c);c=null}var k=e(this).attr("title"),m=e(this).attr("rel"),l=e(this).width();e(this).append('<div class="tooltip"><h3>'+k+'</h3><p class="text">'+m+"</p></div>");e.data(this,"title",k);this.title="";e(this).find(".tooltip").css({left:l+22});c=setTimeout(function(){e(".tooltip").fadeIn(300)},500)}else{this.title=e.data(this,"title");e(".tooltip").fadeOut(500);e(this).children().remove()}});e(".colorPicker").each(function(){var l=e(this),m=l.attr("id"),k=m.replace(/picker-/,"");l.farbtastic("#vfb-"+k)});e(".colorPicker").hide();e(".color:input").focus(function(){var l=e(this).attr("id"),k=l.replace(/vfb-/,"");e("#picker-"+k).show()}).blur(function(){var l=e(this).attr("id"),k=l.replace(/vfb-/,"");e("#picker-"+k).hide()});e(".email-design-default").click(function(o){o.preventDefault();var n=e(this),p=n.attr("id"),l=p.replace(/default/,""),m=n.text(),k;k=(n.hasClass("text-black"))?"black":"white";if(m==e("#vfb"+l).val()){k=""}e("#vfb"+l).val(m).css({"background-color":m,color:k})});e(document).on("change",".hidden-option",function(k){var l=e(this).attr("id").match(new RegExp(/(\d+)$/g),"");if(e(this).val()=="custom"){e("#static-var-"+l).show();e("#edit-form-item-staticvar-"+l).val("").attr("disabled",false)}else{e("#static-var-"+l).hide();e("#edit-form-item-staticvar-"+l).attr("disabled","disabled")}});e(document).on("change",".vfb-options-other",function(k){var l=e(this).attr("id").match(new RegExp(/(\d+)$/g),"");if(e(this).is(":checked")){e("#options-other-"+l).show();e("#options-other-"+l+" :input").prop("disabled",false)}else{e("#options-other-"+l).hide();e("#options-other-"+l+" :input").prop("disabled",true)}});e(document).on("click","a.addOption",function(q){q.preventDefault();var l=e(this).parent().parent().find(".clonedOption").length;var p=l+1;var r=e(this).closest("div").attr("id");var o=e(this).closest("div").children("label").attr("for");var k=o.replace(new RegExp(/(\d+)$/g),"");var n=r.replace(new RegExp(/(\d+)$/g),"");var m=e("#"+r).clone().attr("id",n+p);m.children("label").attr("for",k+p);m.find('input[type="text"]').attr("id",k+p);m.find('input[type="radio"]').attr("value",p);e("#"+n+l).after(m)});e(document).on("click","a.deleteOption",function(l){l.preventDefault();var k=e(this).parent().parent().find(".clonedOption").length;if(k-1==0){alert("You must have at least one option.")}else{e(this).closest("div").remove()}});e(document).on("click","a.addEmail",function(q){q.preventDefault();var l=e(this).closest("#email-details").find(".clonedOption").length;var p=l+1;var r=e(this).closest("div").attr("id");var o=e(this).closest("div").find("label").attr("for");var k=o.replace(new RegExp(/(\d+)$/g),"");var n=r.replace(new RegExp(/(\d+)$/g),"");var m=e("#"+r).clone().attr("id",n+p);m.find("label").attr("for",k+p);m.find("input").attr("id",k+p);e("#"+n+l).after(m)});e(document).on("click","a.deleteEmail",function(l){l.preventDefault();var k=e(this).closest("#email-details").find(".clonedOption").length;if(k-1==0){alert("You must have at least one option.")}else{e(this).closest("div").remove()}});e(".menu-delete, .entry-delete").click(function(){var k=(e(this).hasClass("entry-delete"))?"entry":"form";var l=confirm("You are about to permanently delete this "+k+" and all of its data.\n'Cancel' to stop, 'OK' to delete.");if(l){return true}return false});e(document).on("click","a.item-edit",function(k){k.preventDefault();e(k.target).closest("li").children(".menu-item-settings").slideToggle("fast");e(this).toggleClass("opened")});e(document).on("click","a.vfb-bulking",function(k){k.preventDefault();e("#choicesText").val("");var l=e(this).parent().parent().find(".clonedOption").length;var n=e(this).parent().find(".option:last").attr("id");var m=e(this).parent().find(".clonedOption:last").attr("for");e(".vfb-bulking").data({num:l,id:n,label_for:m})});e(document).on("click","a.vfb-bulk-options",function(l){l.preventDefault();var k=[];e(this).parent().find("li").each(function(m){k.push(e(this).text())});e("#choicesText").val(k.join("\n"))});e(document).on("submit","#vfb_bulk_add_options",function(o){o.preventDefault();var s=e("#choicesText").val(),t=s.split("\n"),m=e(".vfb-bulking").data("num"),k=e(".vfb-bulking").data("id"),r=e(".vfb-bulking").data("label_for"),l=m+1,p=r.replace(new RegExp(/(\d+)$/g),""),n=k.replace(new RegExp(/(\d+)$/g),""),q=[];for(i=0;i<t.length;++i){q[i]=e("#"+k).clone().attr("id",n+l);q[i].children("label").attr("for",p+l);q[i].find('input[type="text"]').attr("id",p+l);q[i].find('input[type="text"]').attr("value",t[i]);q[i].find('input[type="radio"]').attr("value",l);l++}e("#"+k).after(q);e(".vfb-bulking").removeData("num","id","label_for");window.tb_remove()});e("#vfb-main").sortable({placeholder:"sortable-placeholder",items:"div.form-boxes:not(.ui-state-disabled)",stop:function(k,l){opts={url:ajaxurl,type:"POST",async:true,cache:false,dataType:"json",data:{action:"visual_form_builder_form_order",order:e(this).sortable("toArray")}};e.ajax(opts)}});e("#vfb-form-order-type a").click(function(l){l.preventDefault();var k=this.hash.replace(/#/g,"");if(e(this).hasClass("on")){return false}e("#vfb-form-order-type a").removeClass("on");e(this).toggleClass("on");e("#vfb-main").fadeOut();e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_form_order_type",type:k,page:pagenow},success:function(m){e("#vfb-main").attr("class","vfb-order-type-"+k).hide().html(m).fadeIn();return},error:function(n,o,m){alert(n+" "+o+" "+m);return}})});var g=e("#menu-to-edit .item-type:first").text();j(g);function j(k){if("FIELDSET"!==k){e("#vfb-fieldset-first-warning").show()}else{e("#vfb-fieldset-first-warning").hide()}}e("#form-items .vfb-draggable-form-items").draggable({connectToSortable:"#menu-to-edit",helper:function(){var k='<dl class="menu-item-bar"><dt class="menu-item-handle"><span class="item-title">'+e(this).text()+"</span></dt></dl>";return k},distance:2,zIndex:5,cursorAt:{top:20},containment:"document"});e("#menu-to-edit").nestedSortable({listType:"ul",maxLevels:3,handle:".menu-item-handle",placeholder:"sortable-placeholder",forcePlaceholderSize:true,forceHelperSize:true,tolerance:"pointer",toleranceElement:"> dl",items:"li:not(.ui-state-disabled)",create:function(k,l){e(this).css("min-height",e(this).height())},start:function(k,l){if(!e(l.item).hasClass("vfb-draggable-form-items")){l.placeholder.height(l.item.height())}},stop:function(m,n){var l=e("#menu-to-edit .item-type:first").text();if(n.item.hasClass("ui-draggable")){n.item.hide();var q=e("#form-items").serializeArray(),p=n.item.text(),o=$previous=$next="",k=n.item;if(k.closest("li.form-item").size()>0){o=k.closest("li.form-item").attr("id").match(new RegExp(/(\d+)$/g))[0]}if(k.prev().size()>0){$previous=k.prev().attr("id").match(new RegExp(/(\d+)$/g))[0]}opts={url:ajaxurl,type:"POST",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_create_field",order:e(this).nestedSortable("toArray"),data:q,field_type:p,page:pagenow,parent:o,previous:$previous,nonce:e("#_wpnonce").val()},success:function(s){e("#loading-animation").hide();var t=e(s),r=t.closest("li.form-item").attr("id");t.hide().insertBefore(k);e("#"+r).fadeIn();k.remove();if(t.prev().hasClass("ui-state-disabled")){t.hide().insertBefore("#menu-to-edit li.ui-state-disabled:first").fadeIn()}e("#vfb-form-meta-preview iframe").attr("src",e("#vfb-form-meta-preview iframe").attr("src"));return}}}else{opts={url:ajaxurl,type:"POST",async:true,cache:false,dataType:"json",data:{action:"visual_form_builder_sort_field",order:e(this).nestedSortable("toArray")},success:function(r){e("#loading-animation").hide();j(l);e("#vfb-form-meta-preview iframe").attr("src",e("#vfb-form-meta-preview iframe").attr("src"));return}}}e.ajax(opts)}});e("#form-items .vfb-draggable-form-items").click(function(k){k.preventDefault();e(this).data("submit_value",e(this).text())});e(document).on("click","#form-items .vfb-draggable-form-items",function(m){m.preventDefault();var n=e(this).closest("form").serializeArray(),l=e(this).data("submit_value"),k=e("#menu-to-edit li.ui-state-disabled:first").attr("id").match(new RegExp(/(\d+)$/g))[0];e("img.waiting").show();e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_create_field",data:n,field_type:l,previous:k,page:pagenow,nonce:e("#_wpnonce").val()},success:function(o){e("img.waiting").hide();e(o).hide().insertBefore("#menu-to-edit li.ui-state-disabled:first").fadeIn();e("#vfb-form-meta-preview iframe").attr("src",e("#vfb-form-meta-preview iframe").attr("src"));return},error:function(p,q,o){alert(p+" "+q+" "+o);return}})});e(document).on("click","a.item-delete",function(r){r.preventDefault();var o=childs=new Array(),w=0,l=e(this).attr("href"),k=l.split("&"),q=confirm("You are about to permanently delete this field.\n'Cancel' to stop, 'OK' to delete.");if(!q){return false}for(var p=0;p<k.length;p++){var u=k[p].indexOf("=");var s=k[p].substring(0,u);var v=k[p].substring(u+1);o[s]=v}var m=e(this).closest(".form-item").find("ul").children();var n=m.parent().html();m.each(function(t){childs[t]=e(this).attr("id").match(new RegExp(/(\d+)$/g))[0]});var x=e(this).closest("li.form-item").parents("li.form-item");if(x.length){w=x.attr("id").match(new RegExp(/(\d+)$/g))[0]}e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_delete_field",form:o.form,field:o.field,child_ids:childs,parent_id:w,page:pagenow,nonce:o._wpnonce},success:function(t){e("#form_item_"+o.field).addClass("deleting").animate({opacity:0,height:0},350,function(){e(this).before(n).remove()});e("#vfb-form-meta-preview iframe").attr("src",e("#vfb-form-meta-preview iframe").attr("src"));return},error:function(y,z,t){alert("There was an error loading the content");return}})});e(document).on("click","a.vfb-duplicate-field",function(q){q.preventDefault();var p=new Array(),l=e(this).attr("href"),m=l.split("&");for(var n=0;n<m.length;n++){var r=m[n].indexOf("=");var k=m[n].substring(0,r);var o=m[n].substring(r+1);p[k]=o}e("img.waiting").show();e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_duplicate_field",form:p.form,field:p.field,page:pagenow,nonce:p._wpnonce},success:function(t){e("img.waiting").hide();var s=e(t).closest("li.form-item").attr("id");e(t).hide().insertAfter("#form_item_"+p.field);e("#"+s).fadeIn();e("#vfb-form-meta-preview iframe").attr("src",e("#vfb-form-meta-preview iframe").attr("src"));return},error:function(t,u,s){alert(t+" "+u+" "+s);return}})});e(document).on("click",".vfb-show-field-rules",function(k){k.preventDefault();e(this).parent().hide();e("#vfb-build-conditional-fields-container").show()});e(document).on("change","#vfb-conditional-setting",function(k){if(e(this).is(":checked")){e("#vfb-build-conditional-fields-container").show()}else{e("#vfb-build-conditional-fields-container").hide()}});e(document).on("change",".vfb-conditional-other-fields",function(m){var l=e(this).val(),k=e(this).parent().children(".vfb-conditional-other-fields-options");e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_conditional_fields_options",field_id:l,page:pagenow},success:function(n){k.empty().append(n);return},error:function(o,p,n){alert(o+" "+p+" "+n);return}})});e(document).on("click","a.addCondition",function(p){p.preventDefault();var n=e(this).parent(),k=n.find("select"),l=e(this).parent().parent().find(".vfb-conditional-fields-data").length,o=l+1,m=n.clone();m.find("select").each(function(q,r){this.name=this.name.replace(/\[(\d+)\]/,"["+l+"]");e(r).val(k.eq(q).val())});e(n).after(m)});e(document).on("click","a.deleteCondition",function(l){l.preventDefault();e(this).closest("div").remove();var k=e("#vfb-build-conditional-fields-container").find(".vfb-conditional-fields-data");k.each(function(m){e(this).find("select").each(function(){e(this).prop("name").replace(/\[(\d+)\]/,"["+m+"]")})})});e(document).on("submit","#vfb-add-conditional-fields",function(k){k.preventDefault();var l=e(this).closest("form").serialize();e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,data:{action:"visual_form_builder_conditional_fields_save",data:l,page:pagenow},success:function(m){return},error:function(n,o,m){alert(n+" "+o+" "+m);return}});window.tb_remove()});e("#form-settings-button").click(function(m){m.preventDefault();e(this).toggleClass("current");e("#form-settings").slideToggle();var k=e('input[name="form_id"]').val(),l=(e(this).hasClass("current"))?"opened":"closed";e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,data:{action:"visual_form_builder_form_settings",form:k,status:l,page:pagenow},success:function(n){if(l=="closed"){e(".settings-links").removeClass("on");e(".settings-links:first").addClass("on");e(".form-details").slideUp("normal");e(".form-details:first").show("normal")}},error:function(o,p,n){alert("There was an error loading the content");return}})});e(".settings-links").click(function(m){m.preventDefault();e(".settings-links").removeClass("on");e(".form-details").slideUp("normal");if(e(this).next("div").is(":hidden")==true){e(this).addClass("on");e(this).next().slideDown("normal")}var l=e('input[name="form_id"]').val(),k=this.hash.replace(/#/g,"");e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,data:{action:"visual_form_builder_form_settings",form:l,accordion:k,page:pagenow},success:function(n){},error:function(o,p,n){alert("There was an error loading the content");return}})});if(e(".columns-2 #side-sortables, .columns-3 #side-sortables").length>0){var a=e("#vfb_form_items_meta_box"),d=a.offset(),b=55;e(window).on("scroll",function(){if(e(window).scrollTop()>d.top){a.stop().css({marginTop:e(window).scrollTop()-d.top+b})}else{a.stop().css({marginTop:0})}})}var h=e(".form-success-type:checked").val();e("#form-success-message-"+h).show();e(".form-success-type").change(function(){var k=e(this).val();if("text"==k){e("#form-success-message-text").show();e("#form-success-message-page, #form-success-message-redirect").hide()}else{if("page"==k){e("#form-success-message-page").show();e("#form-success-message-text, #form-success-message-redirect").hide()}else{if("redirect"==k){e("#form-success-message-redirect").show();e("#form-success-message-text, #form-success-message-page").hide()}}}});e(".vfb-field-types").click(function(l){l.preventDefault();e("#vfb-field-tabs li").removeClass("tabs");e(this).parent().addClass("tabs");e(".tabs-panel-active").removeClass("tabs-panel-active").addClass("tabs-panel-inactive");var k=this.hash;e(k).removeClass("tabs-panel-inactive").addClass("tabs-panel-active")});e("#visual-form-builder-update").validate({rules:{"form_email_to[]":{email:true},form_email_from:{email:true},form_success_message_redirect:{url:true},form_notification_email_name:{required:function(k){return e("#form-notification-setting").is(":checked")}},form_notification_email_from:{required:function(k){return e("#form-notification-setting").is(":checked")},email:true},form_notification_email:{required:function(k){return e("#form-notification-setting").is(":checked")}},form_entries_allowed:{digits:true}},messages:{form_entries_allowed:"Please enter only digits or leave blank for unlimited entries."},errorPlacement:function(k,l){k.insertAfter(l.parent())}});e("#visual-form-builder-new-form").validate();e("#form-entries-schedule-start").datetimepicker({showTime:false});e("#form-entries-schedule-end").datetimepicker({showTime:false});e("#form_email_from_name_override").change(function(){if(e("#form_email_from_name_override").val()==""){e("#form-email-sender-name").attr("readonly",false)}else{e("#form-email-sender-name").attr("readonly","readonly")}});e("#form_email_from_override").change(function(){if(e("#form_email_from_override").val()==""){e("#form-email-sender").attr("readonly",false)}else{e("#form-email-sender").attr("readonly","readonly")}});if(e("#form-notification-setting").is(":checked")){e("#notification-email").show()}else{e("#notification-email").hide()}e("#form-notification-setting").change(function(){var k=e(this).is(":checked");if(k){e("#notification-email").show();e("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").attr("disabled",false)}else{e("#notification-email").hide();e("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").attr("disabled","disabled")}});if(e("#form-paypal-setting").is(":checked")){e("#paypal-setup").show()}else{e("#paypal-setup").hide()}e("#form-paypal-setting").change(function(){var k=e(this).is(":checked");if(k){e("#paypal-setup").show();e("#form-paypal-email, #form-paypal-currency, #form-paypal-shipping, #form-paypal-tax, #form-paypal-field-price").attr("disabled",false)}else{e("#paypal-setup").hide();e("#form-paypal-email, #form-paypal-currency, #form-paypal-shipping, #form-paypal-tax, #form-paypal-field-price").attr("disabled","disabled")}});if(e("#form-paypal-field-price").val()!==""){e(".assigned-price").show()}else{e(".assigned-price").hide()}e("#form-paypal-field-price").change(function(){var k=e(this).val();e("#paypal-price-switch").show();e.ajax({url:ajaxurl,type:"GET",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_paypal_price",form_id:e('input[name="form_id"]').val(),field_id:k},success:function(l){e(".assigned-price").show().html(l);e("#paypal-price-switch").hide();return},error:function(m,n,l){alert("There was an error loading the content");return}})});var f=e("#vfb-export").find(".vfb-export-filters");e("#vfb-export").find("input:radio").change(function(){f.slideUp("fast");switch(e(this).val()){case"forms":e("#forms-filters").slideDown();break;case"entries":e("#entries-filters").slideDown();break}})});